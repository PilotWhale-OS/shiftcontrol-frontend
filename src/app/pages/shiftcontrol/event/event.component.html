@if (event$ | async; as event) {

  <!-- card grid -->
  <div class="flex flex-row gap-md">

    <!-- event cards -->
    <div class="flex flex-col gap-md w-[min(100%,40rem)]">

      <!-- overview card -->
      <div class="card col-start-1 col-span-2 row-span-2 grid grid-columns-2 gap-lg h-fit">

        <!-- info caption -->
        <h1 class="compact signature-gradient-font">About the Event</h1>

        <div class="flex gap-sm justify-self-end items-center">

          <div class="badge w-fit"
               tooltipMaxWidth="30ex"
               [app-tooltip]="'Event dates of ' + event.eventOverview.name"
          >
            <fa-icon [icon]="icons.date" />
            {{event.eventOverview.startTime | date:"shortDate"}} - {{event.eventOverview.endTime | date:"shortDate"}}
          </div>

          @if ((isPlannerInEvent$ | async) === true) {
            <div class="badge success w-fit"
                 tooltipMaxWidth="30ex"
                 [app-tooltip]="'Event dates of ' + event.eventOverview.name"
            >
              <fa-icon [icon]="icons.userType" />
              Planner
            </div>
          }

          @else {
            <div class="badge success w-fit"
                 tooltipMaxWidth="30ex"
                 [app-tooltip]="'Event dates of ' + event.eventOverview.name"
            >
              <fa-icon [icon]="icons.userType" />
              Volunteer
            </div>
          }

        </div>

        <!-- properties -->
        <p class="col-span-2 whitespace-pre-wrap">{{event.eventOverview.longDescription}}</p>

        <!-- own schedule stats -->
        <div class="flex flex-col items-start gap-xs">
          <small>Your stats</small>
          <div class="badge"
               tooltipMaxWidth="30ex"
               [app-tooltip]="'Days where you signed up for shifts in this event'"
          >
            <fa-icon [icon]="icons.day" />
            {{event.ownEventStatistics.busyDays}} Busy Days
          </div>
          <div class="badge"
               tooltipMaxWidth="30ex"
               [app-tooltip]="'Sum of signed up shifts in this event'"
          >
            <fa-icon [icon]="icons.hour" />
            {{event.ownEventStatistics.totalHours | number:"1.0-0"}} Shift Hours
          </div>
          <div class="badge success"
               tooltipMaxWidth="30ex"
               [app-tooltip]="'Reward points earned during this event'"
          >
            <fa-icon [icon]="icons.rewards" />
            {{event.rewardPoints}} Points Rewarded
          </div>
        </div>

        <!-- public stats -->
        <div class="flex flex-col items-start gap-xs">
          <small>Public stats</small>
          <div class="badge hint"
               tooltipMaxWidth="30ex"
               [app-tooltip]="'Volunteers participating in this event'"
          >
            <fa-icon [icon]="icons.volunteers" />
            {{event.overallEventStatistics.volunteerCount}} Volunteers
          </div>
          <div class="badge hint"
               tooltipMaxWidth="30ex"
               [app-tooltip]="'Duration of shifts during this event'"
          >
            <fa-icon [icon]="icons.hour" />
            {{event.overallEventStatistics.totalHours | number:"1.0-0"}} Shift Hours
          </div>
        </div>

      </div>

      <!-- leaderboard -->
      @if (leaderboard$ | async; as leaderboard) {
        <app-event-leaderboard [leaderboard]="leaderboard ?? undefined"  />
      }

      <!-- availability times card -->
      @if((userType$ | async) === "ASSIGNED") {
        <div class="card col-start-1 col-span-2 row-span-2 grid grid-columns-2 gap-lg h-fit">

          <!-- info -->
          <h1 class="compact signature-gradient-font">
            <fa-icon class="icon" [icon]="icons.unavailable" />
            Manage Absence
          </h1>
          <p class="col-span-2">
            Set your absence times for calendar filtering and better shift suggestions.
          </p>

          <!-- set unavailability -->
          <div class="grid grid-cols-[1fr_auto] col-span-2 gap-xs">

            @if(timeConstraints$ | async; as timeConstraints) {
              @if (timeConstraints.length === 0) {
                <small class="col-span-2">You have not set any absence for this event.</small>
              }

              @for (constraint of timeConstraints; track constraint.id) {
                <div class="flex gap-sm items-center">

                  @if (constraint.type === "EMERGENCY") {
                    <div class="badge hint">
                      <fa-icon [icon]="icons.unavailable" />
                      Emergency
                    </div>

                    {{
                      constraint.from | date:'dd.MM.yyyy'
                    }}
                  }

                  @else {
                    <div class="badge success">
                      <fa-icon [icon]="icons.unavailable" />
                      {{ getUnavailabilityDayLength(constraint) }}
                    </div>

                    {{
                      constraint.from | date:'dd.MM.yyyy HH:mm'
                    }} - {{
                      constraint.to | date:'dd.MM.yyyy HH:mm'
                    }}
                  }

                </div>
                <xsb-input-button action="normal" content="Remove {{constraint.type === 'EMERGENCY' ? 'Emergency' : 'Absence'}}" size="minimal" (click)="removeUnavailability(constraint, event)" />
              }
            }
          </div>
          <div class="flex gap-sm">
            <xsb-input-button content="Add Absence" (click)="showUnavailabilityDialog = true" size="minimal" class="w-fit" />
            <xsb-input-button content="Set Emergency" (click)="showEmergencyDialog = true" size="minimal" class="w-fit" />
          </div>

        </div>
      }

      @if ((userType$ | async) === "ADMIN") {
        <!-- calendar link card -->
        <div class="card interaction spotlight" routerLink="calendar">
          <h1>
            <fa-icon [icon]="icons.calendar" class="icon" />
            View Event Calendar
          </h1>
          <p>
            Manage the schedule of the event.
          </p>
        </div>
      }

      @if ((userType$ | async) === "ADMIN") {
        <!-- manage event -->
        <div class="card interaction" routerLink="manage">

          <!-- info -->
          <h1>
            <fa-icon [icon]="icons.manage" class="icon" />
            Manage Event
          </h1>
          <p>
            Manage event details, locations and PreTalx integration.
          </p>

        </div>
      }

      @if ((isPlannerInEvent$ | async) === true) {
        <!-- manage plans -->
        <div class="card interaction" routerLink="plans">

          <!-- info -->
          <h1>
            <fa-icon [icon]="icons.manage" class="icon" />
            Manage Shift Plans
          </h1>
          <p>
            Manage shift plan invites, roles, shifts, and assignments.
          </p>

        </div>
      }
    </div>

  </div>

  <app-dialog-add-unavailability [viewWhen]="showUnavailabilityDialog" (result)="unavailabilitySubmitted($event, event)" />
  <app-dialog-add-emergency [viewWhen]="showEmergencyDialog" (result)="emergencySubmitted($event, event)" />
}

